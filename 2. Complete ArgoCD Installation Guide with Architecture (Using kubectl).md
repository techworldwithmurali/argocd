

## 🚀 **Complete ArgoCD Installation Guide with Architecture (Using kubectl)**

---

### ✅ **Step 1: Create Namespace for ArgoCD**

```bash
kubectl create namespace argocd
```

---

### ✅ **Step 2: Install ArgoCD Core Components**

Apply the official manifest from ArgoCD GitHub:

```bash
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
```

This deploys the following key components into the `argocd` namespace.

---

### ✅ **ArgoCD Core Components Explained**

#### 📘 1. `argocd-server`

* The **API server** and **backend for the UI and CLI**.
* Handles:

  * Login, authentication
  * RBAC (role-based access)
  * Exposes REST/gRPC APIs
* Communicates with `argocd` CLI and ArgoCD Web UI.

#### 📘 2. `argocd-repo-server`

* **Clones Git repositories** and **renders manifests** using:

  * Helm
  * Kustomize
  * Jsonnet or plain YAML
* Converts Git code into desired Kubernetes configurations.

#### 📘 3. `argocd-application-controller`

* **Monitors and compares** actual vs desired state.
* If drift is detected:

  * Marks the application out of sync.
  * Optionally syncs the cluster back to Git state (auto-sync).
* Performs:

  * Sync
  * Rollbacks
  * Health checks

#### 📘 4. `argocd-dex-server`

* **Authentication provider** using OIDC protocol.
* Supports:

  * GitHub
  * Google
  * LDAP/AD
  * SAML
* Optional but enabled by default for external login.

#### 📘 5. `argocd-redis`

* Internal **cache** used to:

  * Store application status
  * Session data
  * Improve performance of UI/API queries

### ✅ **Step 6: Verify Installation**

```bash
kubectl get all -n argocd
```

You should see pods like:

```
argocd-server
argocd-repo-server
argocd-application-controller
argocd-dex-server
argocd-redis
```

### ✅ **Step 3: Access the ArgoCD UI**

> **Option 1: Port-Forwarding (for local testing)**

```bash
kubectl port-forward svc/argocd-server -n argocd 8080:443
```

Then visit:
🔗 [https://localhost:8080](https://localhost:8080)

---

### ✅ **Step 4: Get Admin Password**

```bash
kubectl get secret argocd-initial-admin-secret -n argocd -o jsonpath="{.data.password}" | base64 -d && echo
```

* **Username:** `admin`
* **Password:** (output above)

> You can change this later via the UI or CLI.

### 🔐 **Understanding ArgoCD Admin Password**

#### 1. **Initial Password (One-Time Use)**

* Created in the secret `argocd-initial-admin-secret`
* Valid **only until** you log in and **change the password** or **enable SSO**
* This secret is **deleted automatically** after the first login (default behavior)

So:
✅ **You only use the initial password once** — during first login.

---

### 🔁 **After First Login**

After the first login:

* The password is **stored as a bcrypt hash** in the `argocd-secret` (`admin.password`)
* ArgoCD now uses **that bcrypt hash** to verify future logins

You **must remember the new password** you set — **you can't retrieve it** from the hash.

### 🔧 **If You Forget the Password**

If you forget the password later, you have **two options**:

#### Option 1: 🔄 **Reset Password Manually (Safe Way)**

Patch a new bcrypt-hashed password into `argocd-secret`:

```bash
htpasswd -bnBC 10 "" "NewPassword123" | tr -d ':\n'
```

Then:

```bash
kubectl patch secret argocd-secret -n argocd \
  -p '{"stringData": {
    "admin.password": "<your-new-bcrypt>",
    "admin.passwordMtime": "'$(date +%FT%T%Z)'"
  }}'
kubectl delete pod -n argocd -l app.kubernetes.io/name=argocd-server
```

#### Option 2: 🔁 **Recreate the Initial Password Secret (Not Default)**

If you've lost access completely, some teams:

* Delete `argocd-secret`
* Reinstall ArgoCD or recreate secrets with new known values

But this is usually not needed if you just patch the password as above.



---

## ✅ Summary: Architecture Flow

```text
     +----------------+
     |    Git Repo    |
     +----------------+
             |
             v
   +----------------------+
   |  argocd-repo-server  |   <-- Clones and renders manifests
   +----------------------+
             |
             v
+-----------------------------+
| argocd-application-controller |  <-- Reconciles and syncs with cluster
+-----------------------------+
             |
             v
   +---------------------+
   |  Kubernetes Cluster |
   +---------------------+

      ▲         ▲
      |         |
      |         v
+---------------------+    +------------------+
|    argocd-server     |<-->|  argocd-dex-server |
| (API + Web Backend) |    | (OIDC Auth Layer) |
+---------------------+    +------------------+
```

---

Would you like the **next step with a sample ArgoCD Application YAML** to deploy a real app using this setup?
